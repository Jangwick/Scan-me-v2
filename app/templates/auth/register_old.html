<!-- Registration Form Template -->
{% extends "auth/auth_base.html" %}

{% block title %}Register - ScanMe Attendance System{% endblock %}

{% block content %}
<div class="register-container">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-10 col-lg-8">
                <div class="register-card">
                    <!-- Header -->
                    <div class="register-header">
                        <h2><i class="fas fa-user-plus me-2"></i>Join ScanMe</h2>
                        <p>Create your account to get started</p>
                    </div>
                    
                    <!-- Registration Form -->
                    <div class="register-form">
                        <form method="POST" action="{{ url_for('auth.register') }}" id="registerForm" data-validate>
                            {{ form.hidden_tag() }}
                            
                            <!-- Name Fields Row -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-floating mb-3">
                                        {{ form.first_name(class="form-control", placeholder="First Name", required=True) }}
                                        {{ form.first_name.label(class="form-label") }}
                                        {% if form.first_name.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.first_name.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating mb-3">
                                        {{ form.last_name(class="form-control", placeholder="Last Name", required=True) }}
                                        {{ form.last_name.label(class="form-label") }}
                                        {% if form.last_name.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.last_name.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Email Field -->
                            <div class="form-floating mb-3">
                                {{ form.email(class="form-control", placeholder="Email Address", required=True) }}
                                {{ form.email.label(class="form-label") }}
                                {% if form.email.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.email.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Username Field -->
                            <div class="form-floating mb-3">
                                {{ form.username(class="form-control", placeholder="Username", required=True) }}
                                {{ form.username.label(class="form-label") }}
                                {% if form.username.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.username.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Role Selection -->
                            <div class="form-group mb-3">
                                <label for="role" class="form-label">Role</label>
                                {{ form.role(class="form-select", id="role") }}
                                {% if form.role.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.role.errors %}{{ error }}{% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                            
                            <!-- Password Fields Row -->
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-floating mb-3">
                                        {{ form.password(class="form-control", placeholder="Password", required=True, id="password") }}
                                        {{ form.password.label(class="form-label") }}
                                        {% if form.password.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.password.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-floating mb-3">
                                        {{ form.confirm_password(class="form-control", placeholder="Confirm Password", required=True, id="confirmPassword") }}
                                        {{ form.confirm_password.label(class="form-label") }}
                                        {% if form.confirm_password.errors %}
                                            <div class="invalid-feedback d-block">
                                                {% for error in form.confirm_password.errors %}{{ error }}{% endfor %}
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Terms and Conditions -->
                            <div class="terms-checkbox">
                                <div class="form-check">
                                    {{ form.agree_terms(class="form-check-input", id="agreeTerms", required=True) }}
                                    <label class="form-check-label" for="agreeTerms">
                                        I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms and Conditions</a>
                                        and <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                                    </label>
                                    {% if form.agree_terms.errors %}
                                        <div class="text-danger mt-1">
                                            {% for error in form.agree_terms.errors %}{{ error }}{% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <!-- Submit Button -->
                            <button type="submit" class="btn btn-success btn-register" id="registerBtn">
                                <i class="fas fa-user-plus me-2"></i>
                                Create Account
                            </button>
                        </form>
                    </div>
                    
                    <!-- Login Link -->
                    <div class="login-link">
                        <p class="mb-0">
                            Already have an account? 
                            <a href="{{ url_for('auth.login') }}">
                                Sign in here <i class="fas fa-arrow-right ms-1"></i>
                            </a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms and Conditions Modal -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">Terms and Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>ScanMe Attendance System - Terms of Service</h6>
                <p>By using the ScanMe Attendance System, you agree to the following terms:</p>
                <ol>
                    <li><strong>Account Usage:</strong> You are responsible for maintaining the security of your account credentials.</li>
                    <li><strong>Data Privacy:</strong> We collect attendance data for educational purposes only.</li>
                    <li><strong>System Usage:</strong> The system should be used only for legitimate attendance tracking.</li>
                    <li><strong>QR Code Security:</strong> Do not share your QR codes with unauthorized persons.</li>
                    <li><strong>Compliance:</strong> Users must comply with institutional policies and regulations.</li>
                </ol>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>ScanMe Privacy Policy</h6>
                <p>Your privacy is important to us. This policy explains how we handle your data:</p>
                <ul>
                    <li><strong>Data Collection:</strong> We collect attendance records, timestamps, and user information.</li>
                    <li><strong>Data Usage:</strong> Information is used solely for attendance tracking and reporting.</li>
                    <li><strong>Data Storage:</strong> All data is stored securely and access is restricted to authorized personnel.</li>
                    <li><strong>Data Sharing:</strong> We do not share personal information with third parties.</li>
                    <li><strong>Data Retention:</strong> Records are retained according to institutional policies.</li>
                    <li><strong>User Rights:</strong> You can request access to or deletion of your personal data.</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    const registerBtn = document.getElementById('registerBtn');
    
    // Smooth animations
    const registerCard = document.querySelector('.register-card');
    if (registerCard) {
        registerCard.style.opacity = '0';
        registerCard.style.transform = 'translateY(30px)';
        
        setTimeout(() => {
            registerCard.style.transition = 'all 0.6s ease-out';
            registerCard.style.opacity = '1';
            registerCard.style.transform = 'translateY(0)';
        }, 100);
    }
    
    // Form validation
    registerForm.addEventListener('submit', function(e) {
        const firstName = document.querySelector('#first_name').value.trim();
        const lastName = document.querySelector('#last_name').value.trim();
        const email = document.querySelector('#email').value.trim();
        const username = document.querySelector('#username').value.trim();
        const password = document.querySelector('#password').value;
        const confirmPassword = document.querySelector('#confirmPassword').value;
        const agreeTerms = document.querySelector('#agreeTerms').checked;
        
        let errors = [];
        
        if (!firstName) errors.push('First name is required');
        if (!lastName) errors.push('Last name is required');
        if (!email) errors.push('Email is required');
        if (!username) errors.push('Username is required');
        if (!password) errors.push('Password is required');
        if (!confirmPassword) errors.push('Please confirm your password');
        if (!agreeTerms) errors.push('You must agree to the terms and conditions');
        
        if (password && confirmPassword && password !== confirmPassword) {
            errors.push('Passwords do not match');
        }
        
        if (password && password.length < 8) {
            errors.push('Password must be at least 8 characters long');
        }
        
        if (errors.length > 0) {
            e.preventDefault();
            alert('Please fix the following errors:\n\n' + errors.join('\n'));
            return false;
        }
        
        // Show loading state
        registerBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Creating Account...';
        registerBtn.disabled = true;
    });
    
    // Password match validation
    const passwordField = document.querySelector('#password');
    const confirmPasswordField = document.querySelector('#confirmPassword');
    
    function checkPasswordMatch() {
        if (passwordField.value && confirmPasswordField.value) {
            if (passwordField.value !== confirmPasswordField.value) {
                confirmPasswordField.setCustomValidity('Passwords do not match');
            } else {
                confirmPasswordField.setCustomValidity('');
            }
        }
    }
    
    if (passwordField && confirmPasswordField) {
        passwordField.addEventListener('input', checkPasswordMatch);
        confirmPasswordField.addEventListener('input', checkPasswordMatch);
    }
    
    // Focus first input
    const firstInput = document.querySelector('#first_name');
    if (firstInput) {
        setTimeout(() => firstInput.focus(), 500);
    }
    
    // Username availability check (placeholder for future implementation)
    const usernameField = document.querySelector('#username');
    if (usernameField) {
        usernameField.addEventListener('blur', function() {
            // Future: AJAX check for username availability
        });
    }
});
</script>
{% endblock %}